<!DOCTYPE html>
<html>
<head>
  <title>ASCII dot generator</title>
  <meta charset="utf-8">
  <style>
    @import url('https://fonts.googleapis.com/css?family=Source+Sans+Pro&subset=latin-ext');
    body {
      font-family: 'Source Sans Pro', sans-serif;
      color: #5a5a5a;
      background-color: white;
    }
    header {
      margin: 2em 5em;
    }
    header img {
      width: 12em;
      margin-left: -1em;
    }
    #src {
      width: 19em;
    }
    #perrow {
      width: 4em;
    }
    header div {
      margin-top: 5px;
    }
    main {
      width: 100%;
    }
  </style>
</head>
<body>
  <header>
  <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgaWQ9InN2ZzIiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMyAxNjUuNjsiCiAgIHZpZXdCb3g9IjAgMCAzMDMgMTY1LjYiCiAgIHk9IjBweCIKICAgeD0iMHB4IgogICB2ZXJzaW9uPSIxLjEiPjxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTY0Ij48cmRmOlJERj48Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+PGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+PGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPjxkYzp0aXRsZT48L2RjOnRpdGxlPjwvY2M6V29yaz48L3JkZjpSREY+PC9tZXRhZGF0YT48ZGVmcwogICAgIGlkPSJkZWZzNjIiIC8+PHN0eWxlCiAgICAgaWQ9InN0eWxlNCIKICAgICB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTt9Cjwvc3R5bGU+PGcKICAgICBpZD0iUHJvdGVjdGlvbl9ab25lIj48cmVjdAogICAgICAgaWQ9InJlY3Q3IgogICAgICAgaGVpZ2h0PSI0MC44IgogICAgICAgd2lkdGg9IjQwLjgiCiAgICAgICBjbGFzcz0ic3QwIgogICAgICAgeT0iMTI0LjgiIC8+PHJlY3QKICAgICAgIGlkPSJyZWN0OSIKICAgICAgIGhlaWdodD0iNDAuOCIKICAgICAgIHdpZHRoPSI0MC44IgogICAgICAgY2xhc3M9InN0MCIKICAgICAgIHk9IjEyNC44IgogICAgICAgeD0iMjYyLjIiIC8+PHJlY3QKICAgICAgIGlkPSJyZWN0MTEiCiAgICAgICBoZWlnaHQ9IjQwLjgiCiAgICAgICB3aWR0aD0iNDAuOCIKICAgICAgIGNsYXNzPSJzdDAiCiAgICAgICB5PSIwLjEiCiAgICAgICB4PSIyNjIuMiIgLz48cmVjdAogICAgICAgaWQ9InJlY3QxMyIKICAgICAgIGhlaWdodD0iNDAuOCIKICAgICAgIHdpZHRoPSI0MC44IgogICAgICAgY2xhc3M9InN0MCIKICAgICAgIHk9IjAuMSIgLz48L2c+PGcKICAgICBpZD0iY2VzbmV0Ij48ZwogICAgICAgaWQ9ImcxOCI+PHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzVhNWE1YTtmaWxsLW9wYWNpdHk6MSIKICAgICAgICAgZD0ibSAyNjIuMSw1OC44IDAsLTggLTkuNSwwIDAsLTkuOCAtOS43LDAgMCw5LjggLTYuNywwIDAsOCA2LjcsMCAwLDE3LjYgYyAwLDEuOSAwLjIsMy42IDAuNSw1LjIgMC4zLDEuNiAxLDMuMSAxLjksNC40IDAuOSwxLjMgMi4yLDIuMyAzLjgsMyAxLjYsMC43IDMuNywxLjEgNi4zLDEuMSAxLjEsMCAyLjIsLTAuMSAzLjQsLTAuMyAxLjIsLTAuMiAyLjIsLTAuNCAzLC0wLjggbCAwLjEsMCAtMC4zLC03LjggLTAuMiwwLjEgYyAtMC42LDAuMyAtMS4yLDAuNSAtMS45LDAuNiAtMC43LDAuMSAtMS40LDAuMiAtMiwwLjIgLTIsMCAtMy40LC0wLjUgLTMuOSwtMS42IC0wLjYsLTEuMSAtMC45LC0yLjUgLTAuOSwtNC4xIGwgMCwtMTcuNiA5LjQsMCB6IgogICAgICAgICBpZD0icGF0aDIwIiAvPjxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiM1YTVhNWE7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIGQ9Im0gODQsNjYgYyAwLjIsLTIuNSAxLjMsLTQuNyAzLjIsLTYuMyAxLjksLTEuNyA0LjMsLTIuNSA3LjEsLTIuNSAxLjUsMCAyLjgsMC4yIDMuOSwwLjcgMS4xLDAuNSAyLDEuMiAyLjgsMiAwLjcsMC44IDEuMywxLjggMS42LDIuOSAwLjMsMSAwLjUsMi4xIDAuNSwzLjMgTCA4NCw2Ni4xIFogTSAxMDcuNyw1NC45IEMgMTA2LDUzLjIgMTA0LjEsNTEuOCAxMDEuOCw1MSA5OS41LDUwLjEgOTcsNDkuNyA5NC40LDQ5LjcgYyAtMi45LDAgLTUuNiwwLjUgLTgsMS41IC0yLjUsMSAtNC42LDIuNCAtNi40LDQuMiAtMS44LDEuOCAtMy4yLDQgLTQuMyw2LjUgLTEsMi41IC0xLjYsNS40IC0xLjYsOC40IDAsMy4xIDAuNSw2IDEuNiw4LjQgMSwyLjUgMi41LDQuNiA0LjMsNi4zIDEuOCwxLjcgNCwzIDYuNSw0IDIuNSwwLjkgNS4zLDEuNCA4LjIsMS40IDcuMiwwIDEyLjcsLTIuNiAxNi41LC03LjcgbCAwLjEsLTAuMSAtNi42LC01LjMgLTAuMSwwLjIgYyAtMSwxLjUgLTIuNCwyLjcgLTQsMy42IEMgOTksODIgOTcsODIuNCA5NC43LDgyLjQgOTMuNCw4Mi40IDkyLDgyLjIgOTAuOCw4MS43IDg5LjYsODEuMiA4OC40LDgwLjYgODcuNCw3OS44IDg2LjQsNzkgODUuNiw3OCA4NSw3Ni45IDg0LjQsNzUuOCA4NC4xLDc0LjcgODQsNzMuNCBsIDI4LjksMCAwLC0wLjIgYyAwLjEsLTAuNCAwLjEsLTAuOSAwLjEsLTEuMyBsIDAsLTEuMyBjIDAsLTMuNCAtMC41LC02LjUgLTEuNCwtOS4xIC0wLjksLTIuNyAtMi4yLC00LjggLTMuOSwtNi42IgogICAgICAgICBpZD0icGF0aDIyIiAvPjxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiM1YTVhNWE7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIGQ9Im0gNTAuNiw2MS44IGMgMC45LC0xLjEgMS45LC0yLjEgMy4yLC0yLjggMS4zLC0wLjcgMi44LC0xLjEgNC41LC0xLjEgMS41LDAgMywwLjQgNC40LDEuMSAxLjQsMC43IDIuNSwxLjYgMy4zLDIuNiBsIDAuMSwwLjIgNi43LC01LjggMC4xLC0wLjEgLTAuMSwtMC4xIGMgLTEuNSwtMS45IC0zLjcsLTMuNCAtNi4zLC00LjQgLTIuNiwtMS4xIC01LjQsLTEuNiAtOC4yLC0xLjYgLTIuOCwwIC01LjUsMC41IC04LDEuNCAtMi41LDEgLTQuNywyLjMgLTYuNSw0LjEgLTEuOSwxLjggLTMuNCwzLjkgLTQuNCw2LjQgLTEuMSwyLjUgLTEuNiw1LjMgLTEuNiw4LjQgMCwzLjIgMC42LDYuMSAxLjYsOC42IDEuMSwyLjUgMi42LDQuNiA0LjUsNi40IDEuOSwxLjggNC4xLDMuMSA2LjYsNCAyLjUsMC45IDUuMiwxLjQgOCwxLjQgMi45LDAgNS42LC0wLjUgOCwtMS40IDIuNSwtMC45IDQuNSwtMi4zIDYuMSwtNCBsIDAuMSwtMC4xIC02LjEsLTYuMiAtMC4xLC0wLjEgLTAuMSwwLjIgYyAtMC45LDEuMSAtMi4xLDEuOSAtMy41LDIuNSAtMS41LDAuNiAtMi45LDAuOSAtNC40LDAuOSAtMS44LDAgLTMuMywtMC40IC00LjYsLTEgQyA1Mi42LDgwLjYgNTEuNSw3OS43IDUwLjYsNzguNSA0OS43LDc3LjQgNDksNzYuMSA0OC42LDc0LjYgNDguMyw3Mi45IDQ4LDcxLjUgNDgsNzAgYyAwLC0xLjUgMC4yLC0yLjkgMC42LC00LjQgMC41LC0xLjQgMS4xLC0yLjcgMiwtMy44IgogICAgICAgICBpZD0icGF0aDI0IiAvPjxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiM1YTVhNWE7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIGQ9Im0gMTg2LDU0LjUgYyAtMS4xLC0xLjQgLTIuNiwtMi42IC00LjQsLTMuNSAtMS44LC0wLjkgLTQsLTEuMyAtNi41LC0xLjMgLTIuOSwwIC01LjQsMC43IC03LjUsMi4yIC0yLDEuNCAtMy40LDMgLTQuMyw0LjcgbCAwLC01LjggLTkuNCwwIDAsMzguNCA5LjksMCAwLC0yMS4xIGMgMCwtMS4yIDAuMiwtMi41IDAuNSwtMy43IDAuNCwtMS4yIDAuOSwtMi4zIDEuNiwtMy4yIDAuNywtMC45IDEuNiwtMS43IDIuNywtMi4zIDEuMSwtMC42IDIuNCwtMC45IDMuOSwtMC45IDEuNSwwIDIuNywwLjMgMy42LDAuOSAwLjksMC42IDEuNiwxLjQgMi4xLDIuNCAwLjUsMSAwLjksMiAxLDMuMiAwLjIsMS4yIDAuMiwyLjQgMC4yLDMuNSBsIDAsMjEuMyA5LjksMCAwLC0yNCBjIDAsLTIgLTAuMywtMy45IC0wLjgsLTUuOCAtMC41LC0xLjkgLTEuNCwtMy41IC0yLjUsLTUiCiAgICAgICAgIGlkPSJwYXRoMjYiIC8+PHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzVhNWE1YTtmaWxsLW9wYWNpdHk6MSIKICAgICAgICAgZD0ibSAxMjkuNyw1OC4xIGMgMS4yLC0wLjYgMi42LC0wLjkgNC4xLC0wLjkgMS43LDAgMy4zLDAuNCA0LjgsMS4yIDEuNSwwLjggMi42LDEuOCAzLjQsMi44IGwgMC4xLDAuMiA2LjUsLTUuNyAtMC4xLC0wLjEgYyAtMS41LC0yIC0zLjcsLTMuNSAtNi4zLC00LjQgLTIuNiwtMSAtNS40LC0xLjQgLTguMSwtMS40IC0xLjksMCAtMy44LDAuMiAtNS42LDAuNyAtMS44LDAuNSAtMy41LDEuMiAtNC45LDIuMiAtMS40LDEgLTIuNiwyLjMgLTMuNSwzLjggLTAuOSwxLjYgLTEuMywzLjQgLTEuMyw1LjYgMCwxLjggMC4zLDMuNCAxLDQuNiAwLjYsMS4yIDEuNSwyLjMgMi42LDMuMSAxLjEsMC44IDIuMywxLjUgMy43LDIgMS4zLDAuNSAyLjgsMC45IDQuMiwxLjIgMi45LDAuNyA1LjEsMS40IDYuNSwyLjEgMS40LDAuNyAyLjEsMS43IDIuMSwzLjIgMCwwLjggLTAuMiwxLjUgLTAuNSwyIC0wLjQsMC42IC0wLjgsMSAtMS40LDEuMyAtMC42LDAuMyAtMS4yLDAuNiAtMS45LDAuNyAtMC43LDAuMiAtMS40LDAuMiAtMi4xLDAuMiAtMiwwIC0zLjksLTAuNCAtNS42LC0xLjMgLTEuNywtMC45IC0zLC0yIC00LjEsLTMuNCBsIC0wLjEsLTAuMiAtNi41LDYuMSAwLjEsMC4xIGMgMS45LDIgNC4yLDMuNiA3LDQuNyAyLjgsMS4xIDUuNywxLjYgOC43LDEuNiAyLjEsMCA0LjEsLTAuMiA2LC0wLjcgMS45LC0wLjUgMy43LC0xLjIgNS4xLC0yLjIgMS41LC0xIDIuNywtMi40IDMuNSwtNCAwLjksLTEuNiAxLjMsLTMuNiAxLjMsLTYgMCwtMS45IC0wLjQsLTMuNSAtMS4xLC00LjggLTAuNywtMS4zIC0xLjcsLTIuNCAtMi45LC0zLjMgLTEuMiwtMC45IC0yLjUsLTEuNiAtNCwtMi4xIC0xLjUsLTAuNSAtMi45LC0xIC00LjMsLTEuMyAtMi43LC0wLjYgLTQuNywtMS4zIC02LjEsLTEuOSAtMS4zLC0wLjYgLTIsLTEuNiAtMiwtMyAtMC4yLC0xLjEgMC40LC0yLjEgMS43LC0yLjciCiAgICAgICAgIGlkPSJwYXRoMjgiIC8+PHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzVhNWE1YTtmaWxsLW9wYWNpdHk6MSIKICAgICAgICAgZD0ibSAyMDQuNiw2NiBjIDAuMiwtMi41IDEuMywtNC43IDMuMiwtNi4zIDEuOSwtMS43IDQuMywtMi41IDcuMSwtMi41IDEuNSwwIDIuOCwwLjIgMy45LDAuNyAxLjEsMC41IDIsMS4yIDIuOCwyIDAuNywwLjggMS4zLDEuOCAxLjYsMi45IDAuMywxIDAuNSwyLjEgMC41LDMuMyBsIC0xOS4xLDAgeiBtIDIzLjcsLTExLjEgYyAtMS43LC0xLjcgLTMuNiwtMy4xIC01LjksLTMuOSAtMi4zLC0wLjkgLTQuOCwtMS4zIC03LjQsLTEuMyAtMi45LDAgLTUuNiwwLjUgLTgsMS41IC0yLjUsMSAtNC42LDIuNCAtNi40LDQuMiAtMS44LDEuOCAtMy4yLDQgLTQuMyw2LjUgLTEsMi41IC0xLjYsNS40IC0xLjYsOC40IDAsMy4xIDAuNSw2IDEuNiw4LjQgMSwyLjUgMi41LDQuNiA0LjMsNi4zIDEuOCwxLjcgNCwzIDYuNSw0IDIuNSwwLjkgNS4zLDEuNCA4LjIsMS40IDcuMiwwIDEyLjcsLTIuNiAxNi41LC03LjcgbCAwLjEsLTAuMSAtNi42LC01LjMgLTAuMSwwLjIgYyAtMSwxLjUgLTIuNCwyLjcgLTQsMy42IC0xLjYsMC45IC0zLjYsMS4zIC01LjksMS4zIC0xLjMsMCAtMi43LC0wLjIgLTMuOSwtMC43IC0xLjIsLTAuNSAtMi40LC0xLjEgLTMuNCwtMS45IC0xLC0wLjggLTEuOCwtMS44IC0yLjQsLTIuOSAtMC42LC0xLjEgLTAuOSwtMi4yIC0xLC0zLjUgbCAyOC45LDAgMCwtMC4yIGMgMC4xLC0wLjQgMC4xLC0wLjkgMC4xLC0xLjMgbCAwLC0xLjMgYyAwLC0zLjQgLTAuNSwtNi41IC0xLjQsLTkuMSAtMC45LC0yLjcgLTIuMiwtNC44IC0zLjksLTYuNiIKICAgICAgICAgaWQ9InBhdGgzMCIgLz48L2c+PGcKICAgICAgIGlkPSJnMzIiPjxwb2x5Z29uCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDY4YTI7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIHBvaW50cz0iMTM2LjEsMTA1LjEgMTQ2LDEwNS4xIDE0NiwxMTUgMTM2LjEsMTE1ICIKICAgICAgICAgaWQ9InBvbHlnb24zNCIgLz48cG9seWdvbgogICAgICAgICBzdHlsZT0iZmlsbDojMDA2OGEyO2ZpbGwtb3BhY2l0eToxIgogICAgICAgICBwb2ludHM9IjEyMC4yLDEwNS4xIDEzMC4xLDEwNS4xIDEzMC4xLDExNSAxMjAuMiwxMTUgIgogICAgICAgICBpZD0icG9seWdvbjM2IiAvPjxwb2x5Z29uCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDY4YTI7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIHBvaW50cz0iMTE0LjIsMTI0LjkgMTE0LjIsMTE1IDEwNC4zLDExNSAxMDQuMywxMjQuOSAiCiAgICAgICAgIGlkPSJwb2x5Z29uMzgiIC8+PHBvbHlnb24KICAgICAgICAgc3R5bGU9ImZpbGw6IzAwNjhhMjtmaWxsLW9wYWNpdHk6MSIKICAgICAgICAgcG9pbnRzPSI5OC4zLDEyNC45IDk4LjMsMTE1IDg4LjUsMTE1IDg4LjUsMTI0LjkgIgogICAgICAgICBpZD0icG9seWdvbjQwIiAvPjxwb2x5Z29uCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDY4YTI7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICAgIHBvaW50cz0iODIuNSwxMjQuOSA4Mi41LDExNSA3Mi42LDExNSA3Mi42LDEyNC45ICIKICAgICAgICAgaWQ9InBvbHlnb240MiIgLz48cG9seWdvbgogICAgICAgICBzdHlsZT0iZmlsbDojMDA2OGEyO2ZpbGwtb3BhY2l0eToxIgogICAgICAgICBwb2ludHM9IjQwLjgsMTA1LjEgNTAuNywxMDUuMSA1MC43LDExNSA0MC44LDExNSAiCiAgICAgICAgIGlkPSJwb2x5Z29uNDQiIC8+PHBvbHlnb24KICAgICAgICAgc3R5bGU9ImZpbGw6IzAwNjhhMjtmaWxsLW9wYWNpdHk6MSIKICAgICAgICAgcG9pbnRzPSI1Ni43LDEwNS4xIDY2LjYsMTA1LjEgNjYuNiwxMTUgNTYuNywxMTUgIgogICAgICAgICBpZD0icG9seWdvbjQ2IiAvPjwvZz48ZwogICAgICAgaWQ9Imc0OCIgLz48ZwogICAgICAgaWQ9Imc1MCIgLz48ZwogICAgICAgaWQ9Imc1MiIgLz48ZwogICAgICAgaWQ9Imc1NCIgLz48ZwogICAgICAgaWQ9Imc1NiIgLz48ZwogICAgICAgaWQ9Imc1OCIgLz48L2c+PC9zdmc+">
  <h1>generátor ASCII teček</h1>
    <div>
      <input type="text" id="src" placeholder="Sem napište text…" autofocus>
      <button id="savebtn">Uložit jako SVG</button>
    </div>
    <div>
      <input type="color" id="colorpick" value="#5a5a5a" list="colors">
      <datalist id="colors">
        <option value="#5a5a5a">
        <option value="#0068a2">
        <option value="#aaaaaa">
        <option value="#00a1de">
        <option value="#a70057">
        <option value="#e60000">
        <option value="#f27930">
        <option value="#fbb731">
        <option value="#008547">
        <option value="#008185">
      </datalist>
      <input id="perrow" list="perrowlist">
      <datalist id="perrowlist">
        <option value="7">
        <option value="14">
        <option value="21">
        <option value="28">
        <option value="35">
        <option value="42">
        <option value="56">
        <option value="63">
        <option value="70">
      </datalist>
      <label for="perrow">teček na řádek</label>,
      <label for="grid">rastr</label>
      <select id="grid">
        <option value="1.6">60 %</option>
        <option value="2">100 %</option>
        <option value="3">200 %</option>
      </select>
    </div>
  </header>
  <main>
    <h2>SVG verze</h2>
    <div id="drawing"></div>
    <h2>Textová verze</h2>
    <p id="textout"></p>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.3/svg.js"></script>
  <script type='text/javascript'>//<![CDATA[
window.onload = function(){
  var input = document.querySelector('#src');
  var textout = document.querySelector('#textout');
  var draw = SVG('drawing');
  var size = 10;
  var dot = draw.defs().rect(size, size).fill("#5a5a5a");
  var group = draw.group();
  var grid = 1.6*size;  // space should be 60% of dot size
  var perrow = 0;
  var vgrid = grid;

  input.addEventListener('input', updateDots(draw, group, textout));
  function updateDots(draw, group, textout) {
    return function() {
      group.remove();
      group = draw.group();
      textout.innerHTML = "";
      var text = this.value;
      var binstring = "";
      for (var i = 0, len = text.length; i < len; i++) {
        binstring += ("000000" + text.charCodeAt(i).toString(2)).substr(-7);
      }
      var row = 0;
      var x, y;
      for (var i = 0, len = binstring.length; i < len; i++) {
        if (perrow > 0) {
          row = Math.floor(i / perrow);
          x = size + grid * (i % perrow);
        } else {
          x = size + grid*i;
        }
        y = size + row*(size+vgrid);
        if (binstring.charAt(i) == "0")
          y += size;
        group.use(dot).move(x, y);
      }
      // one size dot + one size each margin + grid*number of spaces
      var vbwidth = Math.max(400, 3*size +
                             grid*((perrow > 0?perrow:binstring.length)-1)
                            );
      var vbheight = 4*size + (size+vgrid)*row;
      draw.viewbox(0, 0, vbwidth, vbheight);
      for (var i = 0, len = binstring.length; i < len; i++) {
        textout.innerHTML += binstring.charAt(i) == "0"? "▖": "▘";
        if (i % perrow == perrow - 1) {
          textout.innerHTML += "<br>";
        }
      }
    };
  }

  // Filter all non-ASCII characters
  input.addEventListener('keypress', function(e) {
    if (e.which > 127)
        e.preventDefault();
  });

  var colorpick = document.querySelector('#colorpick');
  colorpick.addEventListener('change', changeColor(dot));
  function changeColor(dot) {
    return function() {
      dot.fill(this.value);
      textout.style.color = this.value;
    };
  }

  var gridsel = document.querySelector('#grid');
  gridsel.addEventListener('input', changeGrid());
  function changeGrid() {
    return function() {
      var newgrid = parseFloat(this.value);
      if (newgrid > 0) {
        grid = newgrid*size;
        vgrid = (newgrid>2)? 2*size: grid;
      }
      input.dispatchEvent(new Event('input'));
    };
  }

  var perrowsel = document.querySelector('#perrow');
  perrowsel.addEventListener('input', changePerrow());
  function changePerrow() {
    return function() {
      var newperrow = parseInt(this.value);
      perrow = (newperrow > 0)? newperrow: 0;
      if (perrow > 0 && grid < 2*size) {
        gridsel.selectedIndex = 1;
        gridsel.dispatchEvent(new Event('input'));
      } else if (perrow == 0 && grid > 1.6*size) {
        gridsel.selectedIndex = 0;
        gridsel.dispatchEvent(new Event('input'));
      } else
        input.dispatchEvent(new Event('input'));
    };
  }

  var savebtn = document.querySelector('#savebtn');
  savebtn.addEventListener('click', saveSvg(draw));
  function saveSvg(draw) {
    function download(filename, svgdata) {
      var element = document.createElement('a');
      var dataBlob = new Blob([svgdata], {type: 'image/svg+xml'})
      element.setAttribute('href', URL.createObjectURL(dataBlob));
      element.setAttribute('download', filename);
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }
    function slugify(text) { // source: https://gist.github.com/mathewbyrne/1280286
      return text.toString()
        .replace(/\s+/g, '-')           // Replace spaces with -
        .replace(/[^\w\-]+/g, '_')      // Remove all non-word chars
        .replace(/\-\-+/g, '-')         // Replace multiple - with single -
        .replace(/^-+/, '')             // Trim - from start of text
        .replace(/-+$/, '');            // Trim - from end of text
    }
    return function() {
      var bbox = draw.bbox()
      draw.viewbox(0, 0, 2*size + bbox.w, 2*size + bbox.h);
      var fname = slugify(input.value) + "-asciidots"
      if (grid > 1.6*size)
        fname += "-grid" + (grid-size)/size*100;
      if (perrow > 0)
        fname += "-" + perrow + "perrow";
      fname += ".svg";
      download(fname, draw.svg());
    };
  }

};//]]> 
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-57431937-5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-57431937-5');
  </script>
</body>
</html>
